{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  {% set page_title = config.site_name %}
  {% set page_description = config.site_name %}
  {% if config.site_description is defined and config.site_description %}
    {% set page_description = config.site_description %}
  {% endif %}

  {% if page is defined and page is not none %}
    {% if page.meta is defined and page.meta is not none %}
      {% if page.meta.title is defined and page.meta.title %}
        {% set page_title = page.meta.title %}
      {% endif %}
      {% if page.meta.description is defined and page.meta.description %}
        {% set page_description = page.meta.description %}
      {% endif %}
    {% endif %}
    {% if page.title is defined and page.title %}
      {% set page_title = page.title %}
    {% endif %}
  {% endif %}

  {% set page_title = page_title | striptags %}
  {% set page_description = page_description | striptags %}

  {% set canonical_url = none %}
  {% if config.site_url is defined and config.site_url %}
    {% set canonical_url = config.site_url %}
  {% endif %}
  {% if page is defined and page is not none and page.canonical_url is defined and page.canonical_url %}
    {% set canonical_url = page.canonical_url %}
  {% elif page is defined and page is not none and page.url is defined and page.url and config.site_url is defined and config.site_url %}
    {% set canonical_url = config.site_url ~ page.url %}
  {% endif %}

  {% set social_image = none %}
  {% if config.extra is defined and config.extra.social_image is defined and config.extra.social_image %}
    {% set social_image = config.extra.social_image %}
  {% endif %}
  {% if page is defined and page.meta is defined and page.meta.image is defined and page.meta.image %}
    {% set social_image = page.meta.image %}
  {% endif %}
  {% if social_image and social_image is not startingwith("http") and config.site_url is defined and config.site_url %}
    {% set social_image = config.site_url ~ social_image %}
  {% endif %}

  <meta name="description" content="{{ page_description }}">
  {% if config.extra is defined and config.extra.keywords is defined %}
    <meta name="keywords" content="{{ config.extra.keywords | join(', ') }}">
  {% endif %}
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  {% if config.site_author is defined and config.site_author %}<meta name="author" content="{{ config.site_author }}">{% endif %}
  {% if canonical_url %}<link rel="canonical" href="{{ canonical_url }}">{% endif %}

  <meta property="og:type" content="website">
  <meta property="og:title" content="{{ page_title }}">
  <meta property="og:description" content="{{ page_description }}">
  {% if canonical_url %}<meta property="og:url" content="{{ canonical_url }}">{% endif %}
  {% if config.site_name is defined and config.site_name %}<meta property="og:site_name" content="{{ config.site_name }}">{% endif %}
  {% if social_image %}<meta property="og:image" content="{{ social_image }}">{% endif %}
  {% if config.extra is defined and config.extra.social_image_alt is defined %}<meta property="og:image:alt" content="{{ config.extra.social_image_alt }}">{% endif %}
  {% if config.extra is defined and config.extra.theme_color is defined %}<meta name="theme-color" content="{{ config.extra.theme_color }}">{% endif %}

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page_title }}">
  <meta name="twitter:description" content="{{ page_description }}">
  {% if social_image %}<meta name="twitter:image" content="{{ social_image }}">{% endif %}
  {% if config.extra is defined and config.extra.twitter_site is defined %}<meta name="twitter:site" content="{{ config.extra.twitter_site }}">{% endif %}
  {% if config.extra is defined and config.extra.twitter_creator is defined %}<meta name="twitter:creator" content="{{ config.extra.twitter_creator }}">{% endif %}

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "{{ config.site_name }}",
    "url": "{{ config.site_url }}",
    "description": "{{ page_description }}",
    "inLanguage": "en",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{{ config.site_url }}?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
{% endblock %}
