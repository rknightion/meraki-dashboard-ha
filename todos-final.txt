# Meraki Dashboard Home Assistant Integration - Consolidated TODO List
## Ignore all references to 'todos.txt' or 'todos-claude.txt' those files no longer exist.
================================================================================
                    SECTION 1: HIGH PRIORITY - CRITICAL INFRASTRUCTURE
================================================================================
These foundational changes should be completed first as other features depend on them.


================================================================================
                    SECTION 2: HIGH PRIORITY - NEW DEVICE TYPES
================================================================================

--------------------------------------------------------------------------------
## 5. MX Appliance Support with HA/Uplink Monitoring
--------------------------------------------------------------------------------
Complexity: LARGE
Value: HIGH
Priority: HIGH

DESCRIPTION:
Add full MX (security appliance) support including warm spare HA monitoring,
WAN uplink status, and failover tracking. Critical for networks using MX devices.

CURRENT STATE:
- No MX support - not in DEVICE_TYPE_MAPPINGS
- No constants, device module, transformer, or entity factory
- UplinkStatus TypedDict exists in types.py but never populated

IMPLEMENTATION:
1. Add constants in const.py:
   - SENSOR_TYPE_MX = "MX"
   - MX_SCAN_INTERVAL
   - Model prefixes: MX, vMX, Z-series
   - Sensor metric constants for uplinks, warm spare, failover

2. Update configuration:
   - Add MX to config flow device type selection
   - Update config/schemas.py valid_device_types
   - Add translations for MX options

3. Create devices/mx.py:
   - SensorEntityDescriptions for:
     * wan1_status, wan2_status (binary sensors)
     * wan1_latency, wan1_packet_loss (sensors)
     * wan2_latency, wan2_packet_loss (sensors)
     * active_uplink (wan1/wan2/cellular)
     * warm_spare_enabled (binary sensor)
     * ha_role (primary/spare)
     * last_failover_time (timestamp)
     * failover_status (binary sensor)

4. Add data fetching in hubs:
   - organization.py: getOrganizationApplianceUplinkStatuses
   - network.py: getNetworkApplianceWarmSpare, getDeviceApplianceUplinksSettings
   - Add MX to hub discovery logic

5. Create MXApplianceDataTransformer in transformers.py

6. Register in entity factory:
   - Add _register_mx_entities() function
   - Update factory device type detection

FILES TO MODIFY:
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/config_flow.py
- custom_components/meraki_dashboard/config/schemas.py
- custom_components/meraki_dashboard/devices/mx.py (NEW)
- custom_components/meraki_dashboard/hubs/organization.py
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/data/transformers.py
- custom_components/meraki_dashboard/entities/factory.py
- translations/en.json

PARTIALLY IMPLEMENTED (2026-01-07): Core MV support exists (devices, hub camera data, transformer, factory, tests), but several sensors in this todo are still missing.
--------------------------------------------------------------------------------
## 6. MV Camera Support Implementation
--------------------------------------------------------------------------------
Completed
--------------------------------------------------------------------------------
## 7. MG Cellular Gateway Support
--------------------------------------------------------------------------------
Complexity: LARGE
Value: MEDIUM
Priority: HIGH

DESCRIPTION:
Add MG (cellular gateway) support for HA failover scenarios. MG is often used
as backup WAN uplink and is currently completely unsupported.

CURRENT STATE:
- No MG support - not in const.py or DEVICE_TYPE_MAPPINGS
- cellularGateway productType ignored in hub discovery
- No SIM or cellular-specific sensors

IMPLEMENTATION:
1. Add constants in const.py:
   - SENSOR_TYPE_MG = "MG"
   - MG_SCAN_INTERVAL = 300 (5 min)
   - Model prefixes: MG
   - Cellular metric constants

2. Create devices/mg.py:
   - sim_iccid (sensor - may need redaction option)
   - sim_imsi (sensor - may need redaction option)
   - sim_status (sensor)
   - carrier_info (sensor)
   - signal_strength (sensor)
   - connection_status (binary sensor)
   - data_usage (sensor if available)

3. Update hub discovery:
   - Include networks with productTypes containing "cellularGateway"
   - Add _async_setup_cellular_data() method

4. Add API calls:
   - getNetworkCellularGatewayUplink
   - getDeviceCellularSims (if available)

5. Register in entity factory and add translations

FILES TO MODIFY:
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/devices/mg.py (NEW)
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/config_flow.py
- custom_components/meraki_dashboard/config/schemas.py
- custom_components/meraki_dashboard/entities/factory.py
- custom_components/meraki_dashboard/data/transformers.py


PARTIALLY IMPLEMENTED (2026-01-07): The switch platform exists (MV External RTSP), but there are no MS PoE/port control entities.
--------------------------------------------------------------------------------
## 9. Switch Platform for PoE Control
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: MEDIUM
Priority: MEDIUM

DESCRIPTION:
Add switch entity platform to control PoE on individual switch ports, enabling
automation of PoE-powered devices (cameras, phones, APs).

CURRENT STATE:
- switch.py exists and Platform.SWITCH is registered.
- Current switch entities only cover MV External RTSP.
- MS port status/config data is already fetched in hubs/network.py
  (port_configs, ports_status), but no PoE control entities exist.

IMPLEMENTATION:
1. Extend switch.py with MS PoE/port control entities:
   - PoE enable/disable per port
   - Port enable/disable control

2. Implement PoE switch entity behavior:
   - Use dashboard.switch.updateDeviceSwitchPort
   - Derive current state from switch_data port configs/status

3. Add port cycling service:
   - Service to cycle PoE (off/on with delay)
   - Useful for rebooting PoE devices

4. Add safety options:
   - Confirmation for bulk operations
   - Exclusion list for critical ports

FILES TO CREATE/MODIFY:
- custom_components/meraki_dashboard/switch.py
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/config_flow.py
- custom_components/meraki_dashboard/services.yaml (NEW or extend)
- translations/*.json
--------------------------------------------------------------------------------
## 10. Webhook Integration for Real-Time Events
--------------------------------------------------------------------------------
Complexity: HIGH
Value: HIGH
Priority: MEDIUM

DESCRIPTION:
Implement Meraki webhook receiver for real-time alerts instead of polling.
Dramatically improves responsiveness for critical events (seconds vs minutes).

CURRENT STATE:
- Polling-based updates only (configurable intervals)
- Event service exists but uses polling
- No webhook endpoint registered

IMPLEMENTATION:
1. Create webhook handler:
   - Register webhook endpoint in Home Assistant
   - Handle Meraki alert payload format
   - Validate webhook shared secret

2. Add webhook URL configuration:
   - Generate unique webhook URL per installation
   - Store shared secret in config entry
   - Display URL for user to configure in Meraki dashboard

3. Implement webhook validation:
   - Validate X-Cisco-Meraki-API-Key header
   - Parse Meraki webhook JSON format
   - Handle test webhooks for validation

4. Map webhook events to HA:
   - Fire appropriate Home Assistant events
   - Update relevant entity states immediately
   - Support alert types: connectivity, security, performance

5. Add config flow for webhook setup:
   - Option to enable webhooks
   - Display webhook URL and instructions
   - Test webhook connectivity

FILES TO CREATE/MODIFY:
- custom_components/meraki_dashboard/webhook.py (NEW)
- custom_components/meraki_dashboard/__init__.py
- custom_components/meraki_dashboard/config_flow.py
- custom_components/meraki_dashboard/const.py

================================================================================
                    SECTION 4: MEDIUM PRIORITY - 2025 API FEATURES
================================================================================


PARTIALLY IMPLEMENTED (2026-01-07): Alerts overview and severity counts per network are available, but taxonomy and resolution tracking are not implemented.
--------------------------------------------------------------------------------
## 14. Alert Category Taxonomy + Resolution Tracking
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: MEDIUM
Priority: MEDIUM

DESCRIPTION:
Add structured alert categorization and resolution time tracking, enabling
better alert filtering and SLA monitoring in Home Assistant automations.

CURRENT STATE:
- Organization hub fetches assurance alerts overview by network and stores
  severity counts in recent_alerts plus total active alerts.
- Sensors exist for alerts_count and recent_alerts attributes; alerting_devices
  is derived from device statuses.
- No category taxonomy mapping or resolution time tracking.

IMPLEMENTATION:
1. Add organization-level sensors in devices/organization.py:
   - alerts_critical_count (critical severity)
   - alerts_warning_count (warning severity)
   - alerts_info_count (informational)
   - alerts_connectivity_count (per category)
   - alerts_performance_count
   - alerts_security_count
   - alerts_resolved_last_24h
   - alerts_avg_resolution_time

2. Add API calls in hubs/organization.py:
   - getOrganizationAssuranceAlertsTypes (alert taxonomy)
   - Process lastResolvedAt for resolution tracking

3. Expose alert details as entity attributes:
   - Top N alerts by category
   - Last resolution timestamps

FILES TO MODIFY:
- custom_components/meraki_dashboard/devices/organization.py
- custom_components/meraki_dashboard/hubs/organization.py
- custom_components/meraki_dashboard/const.py
- translations/en.json

PARTIALLY IMPLEMENTED (2026-01-07): CPU load sensor exists but currently relies on a heuristic; no 1m/15m sensors or true CPU metrics.
--------------------------------------------------------------------------------
## 15. Wireless CPU Load Monitoring
--------------------------------------------------------------------------------
Complexity: LOW
Value: MEDIUM
Priority: MEDIUM

DESCRIPTION:
Complete CPU load monitoring for MR wireless devices using real API data
instead of heuristics.

CURRENT STATE:
- MR_SENSOR_CPU_LOAD_5MIN exists and transformer expects cpu.cpuLoad5.
- hubs/network.py _async_get_cpu_load uses getDeviceWirelessStatus and falls
  back to a client-count heuristic when CPU metrics are unavailable.
- No cpu_load_1m or cpu_load_15m sensors.

IMPLEMENTATION:
1. Verify CPU data fetching in hubs/network.py:
   - Confirm getDeviceWirelessStatus (or another endpoint) returns real CPU metrics
   - Add dedicated CPU endpoint call if available

2. Add additional CPU sensors in devices/mr.py:
   - cpu_load_1m (1 minute average)
   - cpu_load_5m (5 minute average)
   - cpu_load_15m (15 minute average)

3. Add transformer normalization for CPU data:
   - Convert to percentage if needed
   - Handle load average format

4. Keep heuristic fallback if API method unavailable

FILES TO MODIFY:
- custom_components/meraki_dashboard/devices/mr.py
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/data/transformers.py
--------------------------------------------------------------------------------
## 16. AutoVPN Status Entities for HA Visibility
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: HIGH
Priority: MEDIUM

DESCRIPTION:
Add VPN tunnel status monitoring for MX devices using AutoVPN. Critical for
multi-site deployments where VPN status affects business operations.

CURRENT STATE:
- No VPN status monitoring
- VPN is critical for HA networks

IMPLEMENTATION:
1. Add org-hub fetch in organization.py:
   - getOrganizationApplianceVpnStatuses
   - Handle items wrapper in 2025 API response format

2. Create org-level VPN sensors:
   - vpn_peers_total
   - vpn_peers_up
   - vpn_peers_down
   - vpn_last_flap (timestamp)

3. Add per-network attributes:
   - Peer states as entity attributes
   - Connection quality metrics if available

4. Update types.py with VPN status data types

5. Add transformer for VPN data processing

FILES TO MODIFY:
- custom_components/meraki_dashboard/hubs/organization.py
- custom_components/meraki_dashboard/devices/organization.py
- custom_components/meraki_dashboard/data/transformers.py
- custom_components/meraki_dashboard/types.py
- custom_components/meraki_dashboard/const.py

================================================================================
                    SECTION 5: MEDIUM PRIORITY - FUNCTIONALITY ENHANCEMENTS
================================================================================

--------------------------------------------------------------------------------
## 17. 6 GHz Channel Utilization Support for Wi-Fi 6E/7
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: MEDIUM
Priority: MEDIUM

DESCRIPTION:
Add support for 6 GHz band (wifi2) channel utilization metrics for Wi-Fi 6E
and Wi-Fi 7 access points.

CURRENT STATE:
- Channel utilization supports wifi0 (2.4 GHz) and wifi1 (5 GHz) only
- No wifi2 (6 GHz) handling in transformers or sensors

IMPLEMENTATION:
1. Extend const.py with 6 GHz metric keys:
   - MR_SENSOR_CHANNEL_UTIL_6GHZ_TOTAL
   - MR_SENSOR_CHANNEL_UTIL_6GHZ_WIFI
   - MR_SENSOR_CHANNEL_UTIL_6GHZ_NON_WIFI

2. Update data/transformers.py:
   - Handle wifi2 key in channel utilization data
   - Graceful handling when wifi2 not present (older APs)

3. Update devices/mr.py:
   - Add SensorEntityDescriptions for 6 GHz metrics

4. Update network hub channel utilization parsing:
   - Include wifi2 if present in response

FILES TO MODIFY:
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/data/transformers.py
- custom_components/meraki_dashboard/devices/mr.py
- custom_components/meraki_dashboard/hubs/network.py

PARTIALLY IMPLEMENTED (2026-01-07): Port utilization/traffic/packet data is collected and transformed, but entities are not exposed in devices/ms.py or the entity factory.
--------------------------------------------------------------------------------
## 18. Surface Additional MS Metrics Already Collected
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: MEDIUM
Priority: MEDIUM

DESCRIPTION:
Expose switch port metrics that are already being collected but not surfaced
as entities (utilization, traffic, packet stats).

CURRENT STATE:
- const.py defines port utilization/traffic metrics and packet counters/rates.
- data/transformers.py aggregates these values from port status and packetCounters.
- hubs/network.py collects port status and packet statistics data.
- devices/ms.py and entities/factory.py do not expose these metrics yet.

IMPLEMENTATION:
1. Add SensorEntityDescriptions in devices/ms.py:
   - port_utilization_sent
   - port_utilization_recv
   - port_traffic_sent_total
   - port_traffic_recv_total
   - port_packets_sent
   - port_packets_recv
   - port_errors
   - port_discards

2. Decide entity strategy:
   - Device-level aggregated vs per-port
   - Add config option if per-port (entity explosion risk)

3. Update transformer if aggregation needed

4. Verify data availability in existing coordinator data

FILES TO MODIFY:
- custom_components/meraki_dashboard/devices/ms.py
- custom_components/meraki_dashboard/entities/factory.py
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/config_flow.py (if adding option)

PARTIALLY IMPLEMENTED (2026-01-07): SSID data is already fetched and counts are exposed, but there are no per-SSID entities.
--------------------------------------------------------------------------------
## 19. SSID-Level Wireless Metrics
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: HIGH
Priority: MEDIUM

DESCRIPTION:
Add per-SSID sensors for wireless networks enabling granular WiFi monitoring
by network name.

CURRENT STATE:
- hubs/network.py fetches SSIDs via getNetworkWirelessSsids and stores them in
  wireless_data.
- MR device/network sensors already expose SSID count, enabled SSIDs, open SSIDs.
- No per-SSID entities or allowlist/blocklist options.

IMPLEMENTATION:
1. Create SSID-specific sensors:
   - ssid_{name}_client_count
   - ssid_{name}_enabled (binary sensor)
   - ssid_{name}_band_steering_enabled
   - ssid_{name}_splash_page_enabled

2. Modify hubs/network.py:
   - Expand SSID data processing
   - Create per-SSID entity data structures

3. Handle SSID naming for entity IDs:
   - Sanitize SSID names (special chars, spaces)
   - Generate valid entity IDs

4. Add config option:
   - Enable/disable per-SSID entities
   - SSID allowlist/blocklist

FILES TO MODIFY:
- custom_components/meraki_dashboard/devices/mr.py
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/config_flow.py
--------------------------------------------------------------------------------
## 20. Enhanced MT Sensor Alert Profiles
--------------------------------------------------------------------------------
Complexity: LOW
Value: MEDIUM
Priority: MEDIUM

DESCRIPTION:
Expose MT sensor alert profile configuration as sensors, showing thresholds
and alert status for environmental monitoring.

CURRENT STATE:
- Sensor readings tracked (temperature, humidity, etc.)
- Alert profiles not exposed
- Users can't see configured thresholds in HA

IMPLEMENTATION:
1. Add API call in hubs/network.py:
   - dashboard.sensor.getNetworkSensorAlertsProfiles
   - Store alert profiles in hub data

2. Create alert profile sensors/attributes:
   - alert_profile_name
   - temperature_threshold_high
   - temperature_threshold_low
   - humidity_threshold_high
   - humidity_threshold_low

3. Add binary sensor for alert triggered status:
   - threshold_exceeded (true when reading outside range)

FILES TO MODIFY:
- custom_components/meraki_dashboard/devices/mt.py
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/const.py

--------------------------------------------------------------------------------
## 21. Sensor-to-Gateway Connectivity Monitoring
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: HIGH
Priority: MEDIUM

DESCRIPTION:
Monitor connectivity between MT sensors and their gateway devices. Critical for
IoT deployments where sensor reliability depends on gateway connectivity.

CURRENT STATE:
- No sensor-to-gateway connectivity monitoring
- MT sensors tracked independently without gateway relationship
- API endpoints available since v1.61.0 (August 2025)

IMPLEMENTATION:
1. Investigate and use sensor gateway relationship APIs:
   - dashboard.sensor.getNetworkSensorRelationships
   - dashboard.devices.getDeviceSensorRelationships

2. Add binary sensors for gateway connectivity:
   - sensor_gateway_connected (online/offline to gateway)
   - sensor_gateway_signal_strength (if available)

3. Modify hubs/network.py:
   - Fetch sensor relationships during device discovery
   - Store gateway mapping in hub data

4. Add transformer in data/transformers.py:
   - Process relationship data
   - Extract connectivity status

FILES TO MODIFY:
- custom_components/meraki_dashboard/devices/mt.py
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/binary_sensor.py
- custom_components/meraki_dashboard/data/transformers.py

--------------------------------------------------------------------------------
## 22. HA-Specific Network Events (Appliance Failover, Uplink Changes)
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: HIGH
Priority: MEDIUM

DESCRIPTION:
Extend event polling to include appliance-specific events (failover, uplink
state changes) for HA networks.

CURRENT STATE:
- Event service only polls MR/MS events
- No appliance event types
- Failover events not captured

IMPLEMENTATION:
1. Extend network hub event polling:
   - Include productType="appliance" for MX networks
   - Add appliance event type filters

2. Add formatting rules in network.py _format_event_for_logbook:
   - Appliance failover events
   - Uplink status change events
   - Warm spare activation events

3. Reuse MerakiEventService for state-change events

4. Add event type constants and handling

FILES TO MODIFY:
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/services/event_service.py
- custom_components/meraki_dashboard/const.py

================================================================================
                    SECTION 6: LOWER PRIORITY - OPTIMIZATION & QUALITY
================================================================================

PARTIALLY IMPLEMENTED (2026-01-07): Per-device MR calls are now batched and cached, but bulk/org-level endpoints are not used.
--------------------------------------------------------------------------------
## 23. Reduce MR API Load with Bulk Endpoints
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: MEDIUM
Priority: LOW

DESCRIPTION:
Replace per-device API calls with bulk/org-level endpoints to reduce API
load and avoid rate limiting on large wireless deployments.

CURRENT STATE:
- Per-device calls remain for getDeviceClients, getDeviceWirelessConnectionStats,
  and getDeviceWirelessLatencyStats.
- These calls are batched via batch_api_calls and cached to reduce churn.
- getOrganizationWirelessDevicesEthernetStatuses is already used at org level.

IMPLEMENTATION:
1. Investigate bulk endpoints:
   - Org/network-level wireless stats endpoints
   - getOrganizationWirelessDevicesEthernetStatuses (already used)

2. Add caching:
   - Use utils/cache.py for redundant request avoidance
   - Cache client lists with short TTL

3. Add semaphore for concurrency:
   - Bound concurrent device API calls
   - Preserve rate limits

4. Add tests verifying call counts

FILES TO MODIFY:
- custom_components/meraki_dashboard/hubs/network.py
- custom_components/meraki_dashboard/utils/helpers.py
- custom_components/meraki_dashboard/utils/cache.py (if exists, or create)
--------------------------------------------------------------------------------
## 24. HA-Focused Diagnostics Panel
--------------------------------------------------------------------------------
Complexity: SMALL
Value: LOW
Priority: LOW

DESCRIPTION:
Add a consolidated diagnostic sensor summarizing HA network health for
simplified troubleshooting.

CURRENT STATE:
- No single-view HA health summary
- Information spread across multiple entities

IMPLEMENTATION:
1. Add diagnostic sensor in devices/organization.py:
   - Summarizes: warm spare status, active uplink, VPN status, last failover
   - Single entity with rich attributes

2. Build from existing hub caches:
   - No extra API calls needed
   - Aggregate from MX, uplink, VPN data

3. Add availability tracking

FILES TO MODIFY:
- custom_components/meraki_dashboard/devices/organization.py
- custom_components/meraki_dashboard/const.py

PARTIALLY IMPLEMENTED (2026-01-07): Migration logic exists with validation/rollback for v1→v2, but no migration changelog or repairs reporting.
--------------------------------------------------------------------------------
## 25. Configuration Migration Framework
--------------------------------------------------------------------------------
Complexity: LOW
Value: MEDIUM
Priority: LOW

DESCRIPTION:
Improve config entry migration to handle schema changes gracefully across
version upgrades with rollback support.

CURRENT STATE:
- config/migration.py implements v1→v2 migration with validation and rollback.
- async_migrate_entry in __init__.py delegates to the migration module.
- No MIGRATION_CHANGELOG, no repairs reporting, and only version 2 handled.

IMPLEMENTATION:
1. Document migration versions:
   - Create MIGRATION_CHANGELOG
   - Track schema changes per version

2. Add migration functions:
   - Version-specific migration handlers
   - Rollback support if needed

3. Add migration validation:
   - Verify migrated data integrity
   - Report migration issues to repairs

FILES TO MODIFY:
- custom_components/meraki_dashboard/config_flow.py
- custom_components/meraki_dashboard/config/migration.py
- docs/ (add migration changelog)
--------------------------------------------------------------------------------
## 26. Integration Test Coverage Expansion
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: HIGH
Priority: LOW

DESCRIPTION:
Expand integration test coverage per TEST_COVERAGE_SUMMARY.md recommendations.

CURRENT STATE:
- Good unit test coverage
- Gaps in integration tests per coverage summary

IMPLEMENTATION:
1. Add entity factory tests:
   - Target: 30-40 tests for factory patterns
   - Cover all device type registrations

2. Add snapshot testing with syrupy:
   - Capture entity state snapshots
   - Detect unintended changes

3. Add performance tests:
   - Large device count scenarios
   - Rate limit behavior validation

4. Add organization multi-network tests:
   - Multiple networks per org
   - Cross-network data aggregation

FILES TO CREATE:
- tests/test_entities_factory.py (NEW)
- tests/test_integration_performance.py (NEW)
- tests/test_organization_multinetwork.py (NEW)

================================================================================
                    SECTION 7: SDK 2.1.0 FEATURE CANDIDATES
================================================================================
New SDK scopes/modules and helpers are available in 2.1.0; these are optional
feature candidates if we want to expand coverage beyond current device types.

--------------------------------------------------------------------------------
## 27. Wireless Controller Telemetry (wirelessController scope)
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: MEDIUM
Priority: LOW

DESCRIPTION:
Expose Wireless Controller (WLC) telemetry now that the SDK provides the
wirelessController scope (async + sync). Useful for controller health,
redundancy, interface status, and AP join health.

IMPLEMENTATION:
1. Define new sensor keys + descriptions:
   - controller_status, redundancy_state, active_controller, interface_status
2. Add a new hub fetcher (organization or network scoped depending on API).
3. Create transformer mappings and entity registrations.
4. Add tests with fixtures for WLC payloads.

FILES TO MODIFY/CREATE:
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/devices/wireless_controller.py (NEW)
- custom_components/meraki_dashboard/data/transformers.py
- custom_components/meraki_dashboard/entities/factory.py
- custom_components/meraki_dashboard/hubs/organization.py
- tests/ (new fixtures + sensor tests)

--------------------------------------------------------------------------------
## 28. Campus Gateway Health & Redundancy (campusGateway scope)
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: MEDIUM
Priority: LOW

DESCRIPTION:
Add campus gateway health monitoring using the new campusGateway scope.
Potential metrics: gateway status, tunnel health, redundancy/failover state.

IMPLEMENTATION:
1. Add gateway status + redundancy sensors.
2. Wire API calls through org hub with throttling.
3. Normalize payloads in transformers + add tests.

FILES TO MODIFY/CREATE:
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/devices/campus_gateway.py (NEW)
- custom_components/meraki_dashboard/data/transformers.py
- custom_components/meraki_dashboard/entities/factory.py
- custom_components/meraki_dashboard/hubs/organization.py
- tests/ (fixtures + sensor tests)

--------------------------------------------------------------------------------
## 29. Spaces Occupancy & Location Analytics (spaces scope)
--------------------------------------------------------------------------------
Complexity: LARGE
Value: MEDIUM
Priority: LOW

DESCRIPTION:
Expose Meraki Spaces analytics (occupancy, dwell, entry/exit counts) now that
the SDK includes the spaces scope and async client support.

IMPLEMENTATION:
1. Add configuration option to enable Spaces polling (privacy + API cost).
2. Add org-level sensors:
   - occupancy_count, entry_count, exit_count, dwell_time_avg
3. Add optional per-space entities if API supports zone granularity.
4. Add transformers + fixtures + tests.

FILES TO MODIFY/CREATE:
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/config_flow.py
- custom_components/meraki_dashboard/devices/spaces.py (NEW)
- custom_components/meraki_dashboard/data/transformers.py
- custom_components/meraki_dashboard/entities/factory.py
- custom_components/meraki_dashboard/hubs/organization.py
- tests/ (fixtures + sensor tests)

--------------------------------------------------------------------------------
## 30. NAC Policy & Posture Visibility (nac scope)
--------------------------------------------------------------------------------
Complexity: MEDIUM
Value: MEDIUM
Priority: LOW

DESCRIPTION:
Add NAC-related org diagnostics (policy compliance counts, auth failures,
posture state breakdowns) using the new nac scope in the SDK.

IMPLEMENTATION:
1. Define NAC diagnostic sensors (compliance count, failures, posture states).
2. Add new API calls via org hub with throttling.
3. Add transformers + tests for NAC payloads.

FILES TO MODIFY/CREATE:
- custom_components/meraki_dashboard/const.py
- custom_components/meraki_dashboard/devices/nac.py (NEW)
- custom_components/meraki_dashboard/data/transformers.py
- custom_components/meraki_dashboard/entities/factory.py
- custom_components/meraki_dashboard/hubs/organization.py
- tests/ (fixtures + sensor tests)

--------------------------------------------------------------------------------
## 31. Array-of-Objects Query Filters (encode_params helper)
--------------------------------------------------------------------------------
Complexity: SMALL
Value: MEDIUM
Priority: LOW

DESCRIPTION:
The SDK now supports array-of-objects query params and documents encode_params.
This could simplify advanced filtering for endpoints that accept complex query
objects, reducing client-side post-processing.

IMPLEMENTATION:
1. Identify endpoints that accept complex filters (alerts, events, clients).
2. Use encode_params (or SDK native support) to pass structured filters.
3. Add unit tests validating query parameter generation.

FILES TO MODIFY:
- custom_components/meraki_dashboard/hubs/organization.py
- custom_components/meraki_dashboard/hubs/network.py
- tests/ (helper or unit tests for filter params)

================================================================================
                    IMPLEMENTATION NOTES FOR LLM AGENTS
================================================================================

1. FOLLOW EXISTING PATTERNS:
   - Use decorator patterns: @handle_api_errors, @with_standard_retries, @performance_monitor
   - Use builder patterns from tests/builders/ for test data
   - Follow typing conventions with mypy compliance
   - Match existing entity descriptor patterns in devices/*.py

2. KEY FILES TO UNDERSTAND FIRST:
   - custom_components/meraki_dashboard/hubs/CLAUDE.md
   - custom_components/meraki_dashboard/CLAUDE.md
   - tests/CLAUDE.md

3. TESTING REQUIREMENTS:
   - All new sensors need test coverage
   - Use existing builder patterns (MerakiDeviceBuilder, SensorDataBuilder)
   - Add JSON fixtures for new API responses
   - Where methods are changed that result in tests failing due to new changes, fix the test or make new tests for new functionality.
   - Run `make lint` and `make test` before submitting

4. API DOCUMENTATION:
   - Use Context7 MCP with library ID /meraki/dashboard-api-python for SDK info
   - Check https://developer.cisco.com/meraki/api-v1/ for endpoint details

5. HOME ASSISTANT CONVENTIONS:
   - Follow entity naming: sensor.{integration}_{device}_{metric}
   - Use appropriate device classes (temperature, humidity, power, etc.)
   - Include proper unit_of_measurement
   - Set state_class for statistics (measurement, total, total_increasing)

6. DEPENDENCY ORDER:
   Items 1-4 (Critical Infrastructure) should be completed first as they are
   foundational for other features. Specifically:
   - #1 (Deprecated endpoints) unblocks scale testing
   - #2 (Async API) unblocks performance improvements
   - #3 (Rate limiting) required for new device types adding more API calls
   - #4 (Entity cleanup) prevents orphan issues as new entities are added

You must never run any git stage or commit commands.
================================================================================
